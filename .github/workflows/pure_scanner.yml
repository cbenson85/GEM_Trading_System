name: Pure Scanner
on:
  workflow_dispatch:
    inputs:
      scan_start:
        description: 'Start date (YYYY-MM-DD)'
        required: true
        default: '2010-01-01'
      scan_end:
        description: 'End date (YYYY-MM-DD)'
        required: true
        default: '2024-12-31'
      batch_size:
        description: 'Stocks per batch (use 1000 for full scan)'
        required: true
        default: '1000'

jobs:
  scan:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 6
      fail-fast: false
      matrix:
        batch: [0,1,2,3,4,5]  # 6 batches Ã— 1000 = 6000 stocks covers everything
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.9'
    
    - name: Install dependencies
      run: pip install requests
    
    - name: Run scanner
      env:
        POLYGON_API_KEY: ${{ secrets.POLYGON_API_KEY }}
        BATCH_NUMBER: ${{ matrix.batch }}
        BATCH_SIZE: ${{ github.event.inputs.batch_size }}
        SCAN_START: ${{ github.event.inputs.scan_start }}
        SCAN_END: ${{ github.event.inputs.scan_end }}
      timeout-minutes: 30  # 30 minutes is plenty
      run: |
        echo "Running batch ${{ matrix.batch }} (1000 stocks)"
        python pure_scanner.py
    
    - name: Commit results
      run: |
        git config --global user.name 'GitHub Actions'
        git config --global user.email 'actions@github.com'
        git add scan_results/
        git commit -m "Batch ${{ matrix.batch }} (1000 stocks)" || echo "No changes"
        git push || echo "Push failed"
